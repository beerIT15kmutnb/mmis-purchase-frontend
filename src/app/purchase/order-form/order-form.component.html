<div style="position:relative">
  <nav class="breadcrumb">
    <a class="breadcrumb-item" href="javascript://" routerLink="/">หน้าหลัก</a>
    <span class="breadcrumb-item active">ใบสั่งซื้อ</span>
    <span style="margin-left: 2%; font-size:20px; font-weight:bold;">{{purchaseOrderNumber}}</span>
    <!-- <span *ngIf="contractId" style="color: red; margin-left: 2%; font-size:20px; font-weight:bold;">เลขที่สัญญา {{contractNo}}</span> -->
    <span style="margin-left:35px">
      <app-order-status [status]="purchaseOrderStatus"></app-order-status>
    </span>
    <span style="float:right;">
      <span *ngIf="contractId" class="label label-danger">เลขที่สัญญา:
        <strong>{{contractNo}}</strong>
      </span>
      <span>ราคารวมสุทธิ</span>
      <span style="margin:10px;font-size:20px;font-weight:bold;" class="text-success">
        {{totalPrice | number: '1.2-2'}}
      </span>
    </span>
  </nav>

  <small class="p5" *ngIf="holidayText">
    <clr-icon shape="info-standard"></clr-icon> {{holidayText}}</small>

  <form>
    <div class="card">
      <div class="card-block form-fid">
        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label for="purchaseOrderBookNumber">เลขที่อ้างอิง</label>
              <input class="form-control" type="text" id="purchaseOrderBookNumber" name="purchaseOrderBookNumber" [(ngModel)]="purchaseOrderBookNumber"
                placeholder="เลขที่อ้างอิงหนังสือ...">
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="required" for="nin">วันที่ออกใบสั่งซื้อ</label>
              <my-date-picker-th (dateChanged)="onDateChanged($event)" name="purchaseDate" [(ngModel)]="purchaseDate" [options]="myDatePickerOptions"
                required></my-date-picker-th>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label class="required" for="generic_type_id">ประเภท</label>
              <div class="select" style="width:100%">
                <select [disabled]="contractId" #selectGenericTypeId id="genericTypeId" name="genericTypeId" [(ngModel)]="genericTypeId"
                  (change)="onChangeGenericType(selectGenericTypeId.value)">
                  <option> กรุณาเลือก...</option>
                  <option *ngFor="let p of productType" [value]="p.generic_type_id">{{ p.generic_type_name }}</option>
                </select>
              </div>
            </div>
          </div>

        </div>
        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label style="width: 120px;" class="required" for="labeler_id">ผู้จำหน่าย</label>
              <!-- <app-search-labeler style="width:100%" (onSelected)="onLabelerSelected($event)" [labelerName]="labelerName"></app-search-labeler> -->
              <po-search-vendor [disabled]="contractId" #searchVendor (onChange)="onChangeVendor($event)" (onSelect)="onSelectVendor($event)"
                style="width: 100%;"></po-search-vendor>
            </div>
          </div>


          <div class="col-md-4">
            <div class="form-group">
              <label class="required" for="budgetTypeId">ประเภทงบประมาณ</label>
              <po-select-budget style="width: 100%;" (onChange)="onChangeBudgetType($event)"></po-select-budget>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="required" for="budget_detail_id">งบประมาณย่อย</label>
              <po-select-sub-budget [selectedId]="budgetDetailId" (onChange)="onChangeSubBudget($event)" style="width: 100%;" #subBudgetList
                [year]="budgetYear" [budgetTypeId]="budgetTypeId"></po-select-sub-budget>
            </div>
          </div>
        </div>

        <div class="row">

          <div class="col-md-4">
            <div class="form-group">
              <label class="required" for="purchaseTypeId">รูปแบบการจัดซื้อ</label>
              <po-select-bid (onChange)="onChangePurchaseType($event)" style="width:100%"></po-select-bid>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label class="required" for="purchaseMethodId">วิธีการจัดซื้อ</label>
              <po-select-bid-process (onChange)="onChangePurchaseMethod($event)" style="width: 100%;"></po-select-bid-process>
            </div>
          </div>


          <div class="col-md-4">
            <div class="form-group">
              <label class="required" for="delivery">กำหนดส่งของภายใน</label>
              <div class="form-control flexbox">
                <input size="1" type="text" id="delivery" name="delivery" [(ngModel)]="delivery">
                <span>วัน</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <clr-datagrid class="grid-order" style="padding-top:15px;">
      <clr-dg-column>
        <ng-container *clrDgHideableColumn="{hidden: false}">
          รายละเอียด
        </ng-container>
      </clr-dg-column>

      <clr-dg-column class="header-right" [style.width.px]="100">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          จำนวน Pack
        </ng-container>
      </clr-dg-column>

      <clr-dg-column class="header-right" [style.width.px]="150">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          ขนาดบรรจุ
        </ng-container>
      </clr-dg-column>

      <clr-dg-column class="header-right" [style.width.px]="120">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          รวม (Base Unit)
        </ng-container>
      </clr-dg-column>

      <clr-dg-column class="header-right" [style.width.px]="120">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          ราคาต่อขนาดบรรจุ
        </ng-container>
      </clr-dg-column>

      <clr-dg-column class="header-right" [style.width.px]="120">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          ราคารวม
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [style.width.px]="100">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          ของแถม
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [style.width.px]="120">
        #
      </clr-dg-column>
      <clr-dg-row *ngFor="let p of purchaseOrderItems; let idx=index;" [clrDgItem]="p">
        <clr-dg-cell>
          {{idx + 1}}. {{p.product_name}}
        </clr-dg-cell>
        <clr-dg-cell>
          <input type="text" name="qty" class="wm-edit-box-number" style="background-color: #FFF9C4" [value]="p.qty" #qty (keyup)="onChangeEditQty(qty.value, idx)"
            appNumberWithoutDot>
        </clr-dg-cell>
        <clr-dg-cell>
          <app-select-box-units [selectedId]="p.unit_generic_id" [genericId]="p.generic_id" (onChange)="onSelectedEditUnits($event, idx)"></app-select-box-units>
        </clr-dg-cell>
        <clr-dg-cell style="text-align: right;">{{p.qty * p.small_qty | number}}</clr-dg-cell>
        <clr-dg-cell>
          <input autocomplete="off" type="text" [value]="p.cost" name="cost" #cost class="wm-edit-box-number" style="background-color: #FFF9C4"
            appNumberOnly (keyup)="onChangeEditCost(cost.value, idx)">
        </clr-dg-cell>
        <clr-dg-cell style="text-align: right;">
          {{p.total_cost | number: '1.2-2'}}
        </clr-dg-cell>
        <clr-dg-cell style="text-align: center;">
          <div class="toggle-switch">
            <input autocomplete="off" type="checkbox" #giveaway id="giveaway-{{idx}}" name="giveaway" [checked]="p.is_giveaway === 'Y'"
              (change)="onChangeEditGiveaway(giveaway, idx)">
            <label for="giveaway-{{idx}}"></label>
          </div>
        </clr-dg-cell>
        <clr-dg-cell style="text-align: center;">
          <button class="btn btn-sm btn-danger wm-small-btn" (click)="removeProduct(idx)">
            <clr-icon shape="trash"></clr-icon>
          </button>
        </clr-dg-cell>
      </clr-dg-row>

      <clr-dg-row class="wm-add-row">
        <clr-dg-cell>
          <app-search-product-vendor [disabled]="!labelerId" #searchProductLabeler (onSelect)="productSearchSelected($event)" [labelerId]="labelerId"></app-search-product-vendor>
        </clr-dg-cell>
        <clr-dg-cell>
          <input type="text" autocomplete="off" name="qty" class="wm-edit-box-number" style="background-color: #FFF9C4" [(ngModel)]="selectedQty"
            appNumberWithoutDot>
        </clr-dg-cell>
        <clr-dg-cell>
          <app-select-box-units #selectBoxUnit (onChange)="onChangeUnit($event)"></app-select-box-units>
        </clr-dg-cell>
        <clr-dg-cell style="text-align: right;">{{selectedUnit.qty * selectedQty | number}}</clr-dg-cell>
        <clr-dg-cell>
          <input autocomplete="off" type="text" name="cost" class="wm-edit-box-number" style="background-color: #FFF9C4" [(ngModel)]="selectedCost"
            appNumberOnly>
        </clr-dg-cell>
        <clr-dg-cell style="text-align: right;">{{selectedCost * selectedQty | number: '1.2-2'}}</clr-dg-cell>
        <clr-dg-cell style="text-align: center;">
          <div class="toggle-switch">
            <input autocomplete="off" type="checkbox" id="giveaway" name="giveaway" [(ngModel)]="isGiveaway" (change)="onChangeGiveaway($event)">
            <label for="giveaway"></label>
          </div>
        </clr-dg-cell>
        <clr-dg-cell>
          <div class="btn-group">
            <button [disabled]="!selectedProduct.product_id || !selectedQty || !selectedCost || !selectedUnit.unit_generic_id" class="btn btn-sm btn-success wm-small-btn"
              (click)="addProductSelected()">
              <clr-icon shape="plus"></clr-icon>
            </button>
            <button [disabled]="!selectedProduct.product_id" class="btn btn-sm btn-danger wm-small-btn" (click)="removeSelected()